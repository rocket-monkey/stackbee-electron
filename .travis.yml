matrix:
  include:
    - os: osx
      osx_image: xcode9.4
      language: node_js
      node_js: "10"
      env:
        - ELECTRON_CACHE=$HOME/.cache/electron
        - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

    - os: linux
      services: docker
      language: generic

# insert encrypted env variable "GH_TOKEN=<token>", see: https://docs.travis-ci.com/user/environment-variables#encrypting-environment-variables
env:
  global:
    - GH_TOKEN=59373cd8f356bac08dc84c0a3a77ce55a395fb82
    # - secure: NV1qtnmLIrm0PNmHZTXGhPx6qXfzzasMkLMcmq1l4OL+9fxaZDciHB7G2S18kdQK/1yR3vHYhGviL54QRS8zuogWVgTqjOyAABq9HLOeMHm3qORTFogTt0ud/6Xm2gHh271zExEuOviwF1vwqQEqcOesjh+Z6Aay0RZJpxEhk6Eh7EJ96X6EqFxrxkmQNM1dfF74NuF7FugQFsz8TUTYu5EmFU3ePACOC3l0u+awH0Qoh76adprNIXnRapop+2cvtPuQbxuYHDNnsxoPQ9a9Ry1CAY4PRwItwBtYyW8XRXKnCEclB+EUsn+Mgs2eeStd3Sa+WJUf5SbJl3iUQ0Rp2aTFJbnopsCQzoExvrw350Wct+SWCap/IfFEHOK0xkETAw+iANnHIlhNqn+fR6zJXz30uwB+ZWxjw/rBbW1JbnU9shL8aupPoYsyHyRM0DcYooyahcBuj/emi2iOi4We+lcVYC84TjWdV++gD9Ze+0ik2d8jcNwRrJuBd2A/W4Jasy0TmIeznELhgwYDnujqTCBNiQAv9e6Eog4kcd1KNJC5HG7FKH2diPzkk/dWImchTJfUOgo+z1YygoYIzrFNkO5k/oCVIsuW528tLwFL9EpzLYAfA1vkFhC7SX4lfQuK0wUSdR8Ew9oCvwE2vQir3jEqvZxheixA8CihupJs4Rc=

cache:
  directories:
    - node_modules
    - app/node_modules
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder

script:
  - |
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      docker run --rm \
        --env-file <(env | grep -iE 'DEBUG|NODE_|ELECTRON_|YARN_|NPM_|CI|CIRCLE|TRAVIS|APPVEYOR_|CSC_|_TOKEN|_KEY|AWS_|STRIP|BUILD_') \
        -v ${PWD}:/project \
        -v ~/.cache/electron:/root/.cache/electron \
        -v ~/.cache/electron-builder:/root/.cache/electron-builder \
        electronuserland/builder:wine \
        /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn release"
    else
      yarn release -mw
    fi
before_cache:
  - rm -rf $HOME/.cache/electron-builder/wine

branches:
  except:
    - "/^v\\d+\\.\\d+\\.\\d+$/"
